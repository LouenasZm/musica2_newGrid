!=================================================================================
module mod_utils
!=================================================================================
  !> Module for common utility routines
!=================================================================================
  implicit none
  !-------------------------------------------------------------------------------
  !-------------------------------------------------------------------------------

contains
  
  !===============================================================================
   function numchar(nn)
  !===============================================================================
    !> Conversion of integer in string of characters
  !===============================================================================
    implicit none
    ! ----------------------------------------------------------------------------
    integer, intent(in) :: nn
    character(len=10) :: numchar ! OUTPUT
    ! ----------------------------------------------------------------------------
    integer :: i,j,nb_figures,r
    integer, dimension(:), allocatable :: num,remainder
    ! ----------------------------------------------------------------------------

    nb_figures=1
    r=nn/10
    do while (r.ne.0)
       nb_figures=nb_figures+1
       r=nn/(10**nb_figures)
    enddo

    allocate(num(nb_figures),remainder(nb_figures+1))

    remainder(1)=nn
    numchar=''
    do i=1,nb_figures
       j=nb_figures-i
       num(i)=remainder(i)/10**j
       numchar=trim(numchar)//char(48+num(i))
       remainder(i+1)=remainder(i)-num(i)*10**j
    enddo
    
  end function numchar

  !===============================================================================
  subroutine conv(tab,taille,nb_elts)
  !===============================================================================
    !> Conversion litte->big or big->little endianness of tab matrix
  !===============================================================================
    implicit none
    ! ----------------------------------------------------------------------------
    character, dimension(*), intent(inout) :: tab
    integer :: taille,nb_elts
    ! ----------------------------------------------------------------------------
    integer :: i,debut,fin
    ! ----------------------------------------------------------------------------

    do i=1,nb_elts
       debut=(i-1)*taille+1
       fin=debut+taille-1
       tab(debut:fin) = tab(fin:debut:-1)
    enddo
    
  end subroutine conv

  !===============================================================================
  subroutine voidp
  !===============================================================================
    !> Void procedure
  !===============================================================================
    implicit none
    ! ----------------------------------------------------------------------------
    ! ----------------------------------------------------------------------------

  end subroutine voidp

  !===============================================================================
  subroutine get_free_unit(uid)
  !===============================================================================
    !> Test to find a free output unit
  !===============================================================================
    use warnstop
    implicit none
    ! ----------------------------------------------------------------------------
    integer, intent(out) :: uid
    ! ----------------------------------------------------------------------------
    logical :: is_free
    ! ----------------------------------------------------------------------------

    do uid=99,9999
       inquire(unit=uid,opened=is_free)
       if (.not.is_free) return
    enddo

    call mpistop('in get_free_unit: Could not find a free unit',0)

  end subroutine get_free_unit

end module mod_utils
